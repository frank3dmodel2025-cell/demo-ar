<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>3D AR Demo - 2 modelos</title>
<script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
<style>
body { margin:0; overflow:hidden; touch-action: none; }
#carrusel {
  position: absolute; bottom:10px; left:0; right:0; z-index:100;
  display:flex; justify-content:center; gap:10px; padding:5px;
  background: rgba(0,0,0,0.4); border-radius:10px;
}
#carrusel img {
  width:60px; height:60px; object-fit: cover; border:2px solid white;
  border-radius:5px; cursor:pointer;
}
</style>
</head>
<body>

<video id="cameraVideo" autoplay playsinline style="position: fixed; top:0; left:0; width:100%; height:100%; object-fit: cover; z-index:-1;"></video>

<a-scene embedded vr-mode-ui="false" renderer="logarithmicDepthBuffer:true">
  <a-entity id="model" gltf-model="url(modelo1.glb)" position="0 1.6 -2" scale="0.5 0.5 0.5" rotation="0 0 0"></a-entity>
  <a-entity light="type: ambient; intensity:0.8"></a-entity>
  <a-entity light="type: directional; intensity:0.6" position="0 4 2"></a-entity>
  <a-entity camera look-controls></a-entity>
</a-scene>

<div id="carrusel">
  <img src="thumb1.png" data-model="modelo1.glb">
  <img src="thumb2.png" data-model="modelo2.glb">
</div>

<script>
const video = document.querySelector('#cameraVideo');
const model = document.querySelector('#model');

// Cámara
navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" }, audio: false })
  .then(stream => { video.srcObject = stream; })
  .catch(err => { alert("No se pudo acceder a la cámara: " + err); });

// Cambiar modelo al tocar miniatura
document.querySelectorAll('#carrusel img').forEach(img => {
  img.addEventListener('click', () => {
    const archivo = img.getAttribute('data-model');
    model.setAttribute('gltf-model', `url(${archivo})`);
    model.setAttribute('scale','0.5 0.5 0.5');
    model.setAttribute('rotation','0 0 0');
  });
});

// Variables de interacción táctil
let initialDistance = null;
let initialScale = 0.5;
let previousX = null;
let rotationY = 0;

const sceneEl = document.querySelector('a-scene');

// Gestos táctiles
sceneEl.addEventListener('touchstart', (e)=>{
  if(e.touches.length === 2){
    initialDistance = Math.hypot(
      e.touches[0].clientX - e.touches[1].clientX,
      e.touches[0].clientY - e.touches[1].clientY
    );
    initialScale = parseFloat(model.getAttribute('scale').x);
  } else if(e.touches.length ===1){
    previousX = e.touches[0].clientX;
  }
});

sceneEl.addEventListener('touchmove', (e)=>{
  if(e.touches.length === 2 && initialDistance){
    const newDistance = Math.hypot(
      e.touches[0].clientX - e.touches[1].clientX,
      e.touches[0].clientY - e.touches[1].clientY
    );
    let newScale = initialScale * (newDistance / initialDistance);
    newScale = Math.min(Math.max(newScale,0.1),5);
    model.setAttribute('scale', `${newScale} ${newScale} ${newScale}`);
  } else if(e.touches.length ===1 && previousX!==null){
    const deltaX = e.touches[0].clientX - previousX;
    rotationY += deltaX * 0.5;
    model.setAttribute('rotation', `0 ${rotationY} 0`);
    previousX = e.touches[0].clientX;
  }
});

sceneEl.addEventListener('touchend', (e)=>{
  if(e.touches.length<2) initialDistance = null;
  if(e.touches.length<1) previousX = null;
});
</script>

</body>
</html>
